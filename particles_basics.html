

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Particles &mdash; pyro 2.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="pyro 2.2 documentation" href="index.html"/>
        <link rel="next" title="Shallow water solvers" href="swe_basics.html"/>
        <link rel="prev" title="Low Mach number hydrodynamics solver" href="lowmach_basics.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> pyro
          

          
          </a>

          
            
            
              <div class="version">
                2.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">pyro basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction to pyro</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Setting up pyro</a></li>
<li class="toctree-l1"><a class="reference internal" href="notes.html">Notes on the numerical methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="design.html">Design ideas</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Working with output</a></li>
<li class="toctree-l1"><a class="reference internal" href="problems.html">Adding a problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="mesh_basics.html">Mesh overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="mesh-examples.html">Mesh examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Solvers</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="advection_basics.html">Advection solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="compressible_basics.html">Compressible hydrodynamics solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="compressible_compare.html">Compressible solver comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="multigrid_basics.html">Multigrid solvers</a></li>
<li class="toctree-l1"><a class="reference internal" href="multigrid-examples.html">Multigrid examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="diffusion_basics.html">Diffusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="incompressible_basics.html">Incompressible hydrodynamics solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="lowmach_basics.html">Low Mach number hydrodynamics solver</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Particles</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#particles-particles-implementation-and-use"><code class="docutils literal"><span class="pre">particles.particles</span></code> implementation and use</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plotting-particles">Plotting particles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="swe_basics.html">Shallow water solvers</a></li>
</ul>
<p class="caption"><span class="caption-text">Utilities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">Analysis routines</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="help.html">Getting help</a></li>
<li class="toctree-l1"><a class="reference internal" href="ack.html">Acknowledgments</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyro</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Particles</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/particles_basics.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

/* nice headers on first paragraph of info/warning boxes */
.admonition .first {
    margin: -12px;
    padding: 6px 12px;
    margin-bottom: 12px;
    color: #fff;
    line-height: 1;
    display: block;
}
.admonition.warning .first {
    background: #f0b37e;
}
.admonition.note .first {
    background: #6ab0de;
}
.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="particles">
<h1>Particles<a class="headerlink" href="#particles" title="Permalink to this headline">¶</a></h1>
<p>A solver for modelling particles.</p>
<div class="section" id="particles-particles-implementation-and-use">
<h2><code class="docutils literal"><span class="pre">particles.particles</span></code> implementation and use<a class="headerlink" href="#particles-particles-implementation-and-use" title="Permalink to this headline">¶</a></h2>
<p>We import the basic particles module functionality as:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">particles.particles</span> <span class="kn">as</span> <span class="nn">particles</span>
</pre></div>
</div>
<p>The particles solver is made up of two classes:</p>
<ul class="simple">
<li><a class="reference internal" href="particles.html#particles.particles.Particle" title="particles.particles.Particle"><code class="xref py py-func docutils literal"><span class="pre">Particle</span></code></a>, which holds
the data about a single particle (its position and velocity);</li>
<li><a class="reference internal" href="particles.html#particles.particles.Particles" title="particles.particles.Particles"><code class="xref py py-func docutils literal"><span class="pre">Particles</span></code></a>, which holds the data
about a collection of particles.</li>
</ul>
<p>The particles are stored as a dictionary, and their positions are updated
based on the velocity on the grid. The keys are tuples of the particles’
initial positions (however the values of the keys themselves are never used
in the module, so this could be altered using e.g. a custom <code class="docutils literal"><span class="pre">particle_generator</span></code>
function without otherwise affecting the behaviour of the module).</p>
<p>The particles can be initialized in a number of ways:</p>
<ul class="simple">
<li><a class="reference internal" href="particles.html#particles.particles.Particles.randomly_generate_particles" title="particles.particles.Particles.randomly_generate_particles"><code class="xref py py-func docutils literal"><span class="pre">randomly_generate_particles</span></code></a>,
which randomly generates <code class="docutils literal"><span class="pre">n_particles</span></code> within the domain.</li>
<li><a class="reference internal" href="particles.html#particles.particles.Particles.grid_generate_particles" title="particles.particles.Particles.grid_generate_particles"><code class="xref py py-func docutils literal"><span class="pre">grid_generate_particles</span></code></a>,
which will generate approximately <code class="docutils literal"><span class="pre">n_particles</span></code> equally spaced in the
x-direction and y-direction (note that it uses the same number of particles in
each direction, so the spacing will be different in each direction if the
domain is not square). The number of particles will be increased/decreased
in order to fill the whole domain.</li>
<li><a class="reference internal" href="particles.html#particles.particles.Particles.array_generate_particles" title="particles.particles.Particles.array_generate_particles"><code class="xref py py-func docutils literal"><span class="pre">array_generate_particles</span></code></a>,
which generates particles based on array of particle positions passed to the
constructor.</li>
<li>The user can define their own <code class="docutils literal"><span class="pre">particle_generator</span></code> function and pass this into the
<code class="docutils literal"><span class="pre">Particles</span></code> constructor. This function takes the number of particles to be
generated and returns a dictionary of <code class="docutils literal"><span class="pre">Particle</span></code> objects.</li>
</ul>
<p>We can turn on/off the particles solver using the following runtime paramters:</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="2"><code class="docutils literal"><span class="pre">[particles]</span></code></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">do_particles</span></code></td>
<td>do we want to model particles? (0=no, 1=yes)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">n_particles</span></code></td>
<td>number of particles to be modelled</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">particle_generator</span></code></td>
<td>how do we initialize the particles? “random”
randomly generates particles throughout the domain,
“grid” generates equally spaced particles, “array”
generates particles at positions given in an array
passed to the constructor. This option can be
overridden by passing a custom generator function to
the <code class="docutils literal"><span class="pre">Particles</span></code> constructor.</td>
</tr>
</tbody>
</table>
<p>Using these runtime parameters, we can initialize particles in a problem using
the following code in the solver’s <code class="docutils literal"><span class="pre">Simulation.initialize</span></code> function:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s2">&quot;particles.do_particles&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">n_particles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s2">&quot;particles.n_particles&quot;</span><span class="p">)</span>
      <span class="n">particle_generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rp</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s2">&quot;particles.particle_generator&quot;</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">particles</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">Particles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cc_data</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">n_particles</span><span class="p">,</span> <span class="n">particle_generator</span><span class="p">)</span>
</pre></div>
</div>
<p>The particles can then be advanced by inserting the following code after the
update of the other variables in the solver’s <code class="docutils literal"><span class="pre">Simulation.evolve</span></code> function:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">update_particles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>
</pre></div>
</div>
<p>This will both update the positions of the particles and enforce the boundary
conditions.</p>
<p>For some problems (e.g. advection), the x- and y- velocities must also be passed
in as arguments to this function as they cannot be accessed using the standard
<code class="docutils literal"><span class="pre">get_var(&quot;velocity&quot;)</span></code> command. In this case, we would instead use</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">particles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">update_particles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="plotting-particles">
<h2>Plotting particles<a class="headerlink" href="#plotting-particles" title="Permalink to this headline">¶</a></h2>
<p>Given the <code class="docutils literal"><span class="pre">Particles</span></code> object <code class="docutils literal"><span class="pre">particles</span></code>, we can plot the particles by getting
their positions using</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">particle_positions</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>
</pre></div>
</div>
<p>In order to track the movement of particles over time, it’s useful
to ‘dye’ the particles based on their initial positions. Assuming that the
keys of the particles dictionary were set as the particles’ initial positions,
this can be done by calling</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">colors</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">get_init_positions</span><span class="p">()</span>
</pre></div>
</div>
<p>For example, if we color the particles from white to black based on their initial
x-position, we can plot them on the figure axis <code class="docutils literal"><span class="pre">ax</span></code> using the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">particle_positions</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>

<span class="c1"># dye particles based on initial x-position</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">particles</span><span class="o">.</span><span class="n">get_init_positions</span><span class="p">()[:,</span> <span class="mi">0</span><span class="p">]</span>

<span class="c1"># plot particles</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">particle_positions</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">particle_positions</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">myg</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">myg</span><span class="o">.</span><span class="n">xmax</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">myg</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="n">myg</span><span class="o">.</span><span class="n">ymax</span><span class="p">])</span>
</pre></div>
</div>
<p>Applying this to the Kelvin-Helmholtz problem with the <code class="docutils literal"><span class="pre">compressible</span></code> solver,
we can produce a plot such as the one below, where the particles have been
plotted on top of the fluid density.</p>
<img alt="_images/particles_kh_compressible.png" class="align-center" src="_images/particles_kh_compressible.png" />
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="swe_basics.html" class="btn btn-neutral float-right" title="Shallow water solvers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lowmach_basics.html" class="btn btn-neutral" title="Low Mach number hydrodynamics solver" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Michael Zingale.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>